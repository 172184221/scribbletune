#!/usr/bin/env node

"use strict";

var path = require('path');
var fs = require('fs');
var _ = require('lodash');
var lib = path.join(path.dirname(fs.realpathSync(__filename)), '../lib');

var scribbletune = require(lib + '/scribbletune.js');

//get the commandline arguments
var argv = require('minimist')(process.argv.slice(2));

//setup defaults
var _ticks = argv.ticks || 512;
var _root = argv.root || 'c';
var _mode = argv.mode || argv.scale || 'ionian';
var _octave = argv.octave || 3;
var _pattern = argv.pattern || 'x-x-x-x-x-x-x-x-';
var _notes = argv.notes && argv.notes.split(',') || scribbletune.mode.get(_root, _mode, _octave);
var _noteLength = argv.noteLength || 1/16;


var _sizzle = false;
if(argv.sizzle === 'true') {
	_sizzle = true;
}

var _sizzleMap = '';
if(argv.sizzleMap) {
	_sizzleMap = argv.sizzleMap;
}

var _shuffle = false;
if(argv.shuffle === 'true') {
	_shuffle = true;
}

//create a clip
var clip = 
	scribbletune.generate.clip({
		ticks: _ticks,
		notes: _notes, 
		pattern: _pattern,
		sizzle: _sizzle,
		sizzleMap: _sizzleMap,
		shuffle: _shuffle,
		noteLength: _noteLength
	});

scribbletune.midi.writeToFile(clip);